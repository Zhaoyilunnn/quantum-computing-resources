# 理解探测器错误模型（.dem）文件

`.dem` 文件是一种人可以读懂的说明文件，它描述了量子计算中可能发生的各种错误。解码器软件会使用这个文件来理解错误的模式，并根据探测器（detector）给出的“症状”来推测并修正最终的计算结果。

## 文件基本结构

一个 `.dem` 文件由很多行组成。每一行可以是一个指令，也可以是代码块的开始或结束，或者干脆是空行。你可以在每一行的结尾用 `#` 号来添加注释，这不会影响程序对文件的解读。

文件的语法规则可以用一种格式来定义，我们不用深入研究这种格式，只需要理解它的核心思想。比如，一条指令通常包含几个部分：

- **指令名称**: 比如 `error` 或 `detector`。
- **参数**: 放在圆括号 `()` 里，用逗号隔开，通常是数字。
- **目标**: 指令要操作的对象，跟在后面，用空格隔开。

举个例子，`error(0.1) D5 D6 L0` 就是一条指令。

- `error` 是指令的**名称**。
- `(0.1)` 是它的**参数**，这里代表错误发生的概率是10%。
- `D5`、`D6` 和 `L0` 是它的**目标**。

## 核心指令解析

`.dem` 文件通过一系列指令来构建一个完整的错误模型。下面我们来了解几个最关键的指令。

### `error` 指令

这是最重要的指令，它定义了一种具体的错误。它的第一个参数是一个概率值，表示这个错误发生的可能性。后面跟着的目标则说明了这个错误会产生什么后果。

例如：`error(0.1) D2 D3 L0`
这条指令描述了一个概率为 10% 的错误。当这个错误发生时，会产生两个后果：

1. **症状 (Symptoms)**: 探测器 `D2` 和 `D3` 会被触发。你可以把探测器想象成量子系统中的警报器，它们响了，就说明有地方出错了。
2. **逻辑帧变化 (Frame Changes)**: 逻辑量子比特 `L0` 的状态会被翻转。这是错误对我们最终想保护的计算结果造成的影响。

有时候，一个复杂的错误可以被看作是几个简单错误组合起来的结果。`^` 符号就是用来表示这种拆分的。

例如：`error(0.02) D2 L0 ^ D5 D6`
这个错误有 2% 的概率发生，它的症状是 `D2`、`D5`、`D6` 被触发，同时逻辑比特 `L0` 被翻转。`^` 符号暗示解码器，这个错误可以被理解为两个更简单的部分：一部分是 `D2 L0`，另一部分是 `D5 D6`。这种信息可以帮助解码器更有效地找到修正方案。

### `detector` 指令

这个指令用来声明一个探测器，并且可以给它赋予时空坐标。虽然我们可以在 `error` 指令中直接使用探测器（比如 `D5`）而无需预先声明，但使用 `detector` 指令可以提供额外的位置信息，这对于可视化和某些高级解码算法很有帮助。

例如：`detector(2.5, 3.5, 6) D7`
这条指令声明了探测器 `D7`，并告诉我们它位于坐标 `(2.5, 3.5, 6)`。这就像在三维空间中标记出了一个警报器的具体位置。

### `logical_observable` 指令

这个指令用来声明一个逻辑量子比特。和探测器一样，即使没有错误会影响它，我们也可以用这个指令来确保它存在于模型中。

例如：`logical_observable L1`
这行代码确保了模型知道存在一个名为 `L1` 的逻辑量子比特。

### `shift_detectors` 指令

在描述具有重复结构的量子纠错码（如表面码）时，很多错误模式会一遍又一遍地出现，但每次都作用在不同的量子比特上。`shift_detectors` 指令就是为了处理这种情况而设计的。它会“移动”坐标系和探测器的索引，这样在循环中定义的探测器就不会全部重叠在一起。

例如：`shift_detectors(0.5, 0.5) 1`
这条指令做了两件事：

1. 将坐标系的第一个和第二个维度分别增加 `0.5`。
2. 将探测器的基础索引增加 `1`。

这样一来，下一次在代码中写 `D0` 时，它实际指向的是一个新的探测器（原来的 `D1`），并且它的坐标也相应地发生了平移。

### `repeat` 代码块

这是一个非常有用的结构，可以让我们重复执行一组指令，而不用把它们复制粘贴很多遍。这在生成大规模的纠错码模型时尤其方便。

看一个例子，如何用 `repeat` 来定义一条对角线上的探测器和它们之间的错误：

```
# 先在原点定义第一个探测器
detector(0, 0) D0

# 重复1000次
repeat 1000 {
    # 定义下一个探测器，位置在相对(0.5, 0.5)的地方
    detector(0.5, 0.5) D1
    # 定义一个连接这两个探测器的错误
    error(0.01) D0 D1
    # 移动坐标和探测器索引，为下一次循环做准备
    shift_detectors(0.5, 0.5) 1
}
```

这个代码块高效地生成了一个包含1001个探测器和1000种连接错误的链条。

## 目标 (Target) 的类型

指令后面跟着的目标有几种不同的类型，它们以不同的前缀来区分。

- **`D#`**: 代表一个相对探测器目标，`#` 是一个数字。例如 `D5`。它的确切索引需要加上当前的探测器索引偏移量。
- **`L#`**: 代表一个逻辑量子比特目标，`#` 是一个数字。例如 `L0`。
- **`#`**: 一个纯数字。比如 `repeat` 指令后面的 `1000`。
- **`^`**: 一个分隔符，只在 `error` 指令中使用，用来建议错误的拆分方式。
